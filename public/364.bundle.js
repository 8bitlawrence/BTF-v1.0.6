(self.webpackChunkbtf_v1_0_6=self.webpackChunkbtf_v1_0_6||[]).push([[364],{364:()=>{const e="mini_gacha_state_v1";function t(){try{const t=localStorage.getItem(e);return t?JSON.parse(t):null}catch(e){return console.error("Error loading state:",e),null}}function n(){const e=t();return e?.username||null}const r=document.getElementById("usernameInput"),a=document.getElementById("registerBtn"),i=document.getElementById("registrationStatus"),o=document.getElementById("currentUsername"),l=document.getElementById("displayUsername"),s=document.getElementById("changeUsernameBtn"),d=(document.getElementById("registerSection"),document.getElementById("refreshLeaderboard")),c=document.getElementById("submitScore"),u=document.getElementById("leaderboardList"),m=document.getElementById("playerInventoryModal"),y=document.getElementById("closePlayerInventory"),p=document.getElementById("playerInventoryTitle"),g=document.getElementById("playerCoins"),v=document.getElementById("playerRank"),h=document.getElementById("playerPetsList"),f=document.getElementById("playerFruitsList"),_=[{id:"pet_c_1",name:"Dirt Fox",rarity:"common",weight:50,value:20},{id:"pet_c_2",name:"Dirt Finch",rarity:"common",weight:50,value:20},{id:"pet_c_3",name:"Dirt Turtle",rarity:"common",weight:50,value:25},{id:"pet_r_1",name:"Dusk Fox",rarity:"rare",weight:25,value:150},{id:"pet_r_2",name:"Aero Lynx",rarity:"rare",weight:25,value:160},{id:"pet_e_1",name:"Nebula Kirin",rarity:"epic",weight:10,value:800},{id:"pet_u_1",name:"Singularity Phoenix",rarity:"unique",weight:.08,value:2e4},{id:"pet_u_2",name:"Timekeeper Dragon",rarity:"unique",weight:.05,value:3e4},{id:"pet_sp_1",name:"Suspicious Creature",rarity:"special",weight:50,value:1e3},{id:"pet_l_1",name:"Infinity Golem",rarity:"legendary",weight:.5,value:1200},{id:"pet_s_1",name:"Nightmare Skeleton",rarity:"spooky",weight:.3,value:2500},{id:"pet_ch_1",name:"Chroma Beast",rarity:"chromatic",weight:.25,value:5e3},{id:"pet_s_2",name:"Spooky Ghost",rarity:"spooky",weight:.3,value:2200}],b=[{id:"fruit_c_1",name:"Pebble",rarity:"common",weight:50,value:5},{id:"fruit_c_2",name:"Marble",rarity:"common",weight:50,value:5},{id:"fruit_r_1",name:"Ruby",rarity:"rare",weight:25,value:50},{id:"fruit_r_2",name:"Sapphire",rarity:"rare",weight:25,value:55},{id:"fruit_e_1",name:"Diamond",rarity:"epic",weight:10,value:300},{id:"fruit_u_1",name:"Aurora Berry",rarity:"unique",weight:.06,value:4e3},{id:"fruit_u_2",name:"Stellar Pomegranate",rarity:"unique",weight:.04,value:6e3},{id:"fruit_l_1",name:"Cosmic Shard",rarity:"legendary",weight:.8,value:450},{id:"fruit_s_1",name:"Cursed Pumpkin",rarity:"spooky",weight:.4,value:600},{id:"fruit_ch_1",name:"Prism Crystal",rarity:"chromatic",weight:.3,value:1200}],x={common:1,rare:3,epic:8,special:12,legendary:20,spooky:30,chromatic:80,unique:60},E="btf_leaderboard_v1";function w(){try{const e=localStorage.getItem(E);return e?JSON.parse(e):[]}catch(e){return[]}}function C(){const e=n();e?(r.value="",l.textContent=e,o.style.display="block",i.style.display="none",r.parentElement.style.display="none"):(o.style.display="none",i.style.display="block",r.parentElement.style.display="flex")}async function S(){u.innerHTML='<p style="text-align:center;color:var(--muted);padding:40px">Loading local scoresâ€¦</p>';try{const e=w();if(0===e.length)return void(u.innerHTML='<p style="text-align:center;color:var(--muted);padding:40px">No local scores on this device yet. Be the first to submit!</p>');e.sort((e,t)=>t.coins-e.coins);let t='<table style="width:100%;border-collapse:collapse">';t+='<thead><tr style="border-bottom:2px solid rgba(255,255,255,0.1)">',t+='<th style="padding:12px;text-align:left;color:var(--muted)">Rank</th>',t+='<th style="padding:12px;text-align:left;color:var(--muted)">Player</th>',t+='<th style="padding:12px;text-align:right;color:var(--muted)">Coins</th>',t+='<th style="padding:12px;text-align:center;color:var(--muted)">Action</th>',t+="</tr></thead>",t+="<tbody>",e.forEach((e,r)=>{const a=r+1;let i=a,o="white";1===a?i="ðŸ¥‡":2===a?i="ðŸ¥ˆ":3===a?i="ðŸ¥‰":a<=10?o="#ffd700":a<=25&&(o="#c0c0c0");const l=e.username===n();t+=`<tr style="border-bottom:1px solid rgba(255,255,255,0.05);${l?"background:rgba(16,185,129,0.1);border-left:3px solid #10b981":""}">`,t+=`<td style="padding:12px;color:${o};font-weight:600;font-size:18px">${i}</td>`,t+=`<td style="padding:12px;color:white;font-weight:${l?"700":"400"}">${e.username}${l?" (You)":""}</td>`,t+=`<td style="padding:12px;text-align:right;color:#ffd700;font-weight:600">${(e.coins||0).toLocaleString()}</td>`,t+=`<td style="padding:12px;text-align:center"><button class="view-player-btn muted" data-index="${r}" style="padding:6px 12px">View</button></td>`,t+="</tr>"}),t+="</tbody></table>",u.innerHTML=t,document.querySelectorAll(".view-player-btn").forEach(t=>{t.addEventListener("click",t=>{const n=parseInt(t.target.getAttribute("data-index"));!function(e,t){p.textContent=`${e.username}'s Inventory`,g.textContent=(e.coins||0).toLocaleString(),v.textContent=`#${t}`;const n=e.inventory||{};h.innerHTML="";const r=Object.entries(n).sort((e,t)=>t[1]-e[1]);if(0===r.length)h.innerHTML='<div style="color:var(--muted)">No pets yet.</div>';else for(const[e,t]of r){const n=_.find(t=>t.id===e)||{name:e,rarity:"common",value:5},r=document.createElement("div");r.className="inventory-item";const a=document.createElement("div");a.className=`badge ${n.rarity}`,a.textContent=n.rarity.toUpperCase();const i=document.createElement("div");i.innerHTML=`<div style="font-weight:700">${n.name}</div><div style="color:var(--muted);font-size:12px">x${t} â€¢ Sell: ${n.value}c</div>`;const o=(x[n.rarity]||0)*t,l=document.createElement("div");l.style.color="var(--muted)",l.style.fontSize="12px",l.textContent=`CPS: ${o}`,i.appendChild(l);const s=document.createElement("div");s.style.marginLeft="auto";const d=document.createElement("span");d.style.color="var(--muted)",d.style.fontSize="12px",d.textContent="view-only",s.appendChild(d),r.appendChild(a),r.appendChild(i),r.appendChild(s),h.appendChild(r)}const a=e.fruits||{};f.innerHTML="";const i=Object.entries(a).sort((e,t)=>t[1]-e[1]);if(0===i.length)f.innerHTML='<div style="color:var(--muted)">No fruits yet.</div>';else for(const[e,t]of i){const n=b.find(t=>t.id===e)||{name:e,rarity:"common",value:1},r=document.createElement("div");r.className="inventory-item";const a=document.createElement("div");a.className=`badge ${n.rarity}`,a.textContent=n.rarity.toUpperCase();const i=document.createElement("div");i.innerHTML=`<div style="font-weight:700">${n.name}</div><div style="color:var(--muted);font-size:12px">x${t} â€¢ Sell: ${n.value}c</div>`;const o=document.createElement("div");o.style.marginLeft="auto";const l=document.createElement("span");l.style.color="var(--muted)",l.style.fontSize="12px",l.textContent="view-only",o.appendChild(l),r.appendChild(a),r.appendChild(i),r.appendChild(o),f.appendChild(r)}m.style.display="flex"}(e[n],n+1)})})}catch(e){console.error("Error loading leaderboard:",e),u.innerHTML='<p style="text-align:center;color:#ff4444;padding:40px">Error loading leaderboard. Please try again.</p>'}}a.addEventListener("click",()=>{const t=r.value.trim();t.length<3?alert("Username must be at least 3 characters long!"):t.length>20?alert("Username must be 20 characters or less!"):/^[a-zA-Z0-9_-]+$/.test(t)?function(t){try{const n=localStorage.getItem(e),r=n?JSON.parse(n):{};return r.username=t,localStorage.setItem(e,JSON.stringify(r)),!0}catch(e){return console.error("Error saving username:",e),!1}}(t)?(alert(`Successfully registered as "${t}"!`),C(),S()):alert("Error saving username. Please try again."):alert("Username can only contain letters, numbers, underscores, and hyphens!")}),s.addEventListener("click",()=>{confirm("Are you sure you want to change your username? Your previous scores will remain under the old username.")&&(o.style.display="none",i.style.display="block",r.parentElement.style.display="flex",r.value="",r.focus())}),c.addEventListener("click",async()=>{const e=n();if(!e)return void alert("Please register a username first!");const r=t();if(!r)return void alert("No game data found. Play the game first!");const a={username:e,coins:r.coins||0,inventory:r.inventory||{},fruits:r.fruits||{},timestamp:Date.now()},i=w().filter(t=>t.username!==e);i.push(a),i.sort((e,t)=>t.coins-e.coins),!function(e){try{return localStorage.setItem(E,JSON.stringify(e)),!0}catch(e){return console.error("Error saving leaderboard:",e),!1}}(i.slice(0,100))?alert("Error submitting score. Please try again."):(alert("Score submitted locally! (This device only)"),S())}),y.addEventListener("click",()=>{m.style.display="none"}),m.querySelector(".modal-backdrop").addEventListener("click",()=>{m.style.display="none"}),d.addEventListener("click",()=>{S()}),C(),S()}}]);