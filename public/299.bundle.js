(self.webpackChunkbtf_v1_0_6=self.webpackChunkbtf_v1_0_6||[]).push([[299],{299:()=>{const t=1e5,e=3e5,n=1e4,s=8e3,o=1e6,a=document.getElementById("buyLuckPotion"),i=document.getElementById("potionTimer"),c=document.getElementById("buyBennyBoost"),r=document.getElementById("bennyTimer"),l=document.getElementById("buyPumpkinBlessing"),d=document.getElementById("blessingTimer"),u=document.getElementById("buySlotMachine"),y=document.getElementById("slotsPurchased"),m=document.getElementById("tearsDisplay"),p=document.getElementById("brewFruitList"),f=document.getElementById("brewSelection"),h=document.getElementById("brewPreview"),v=document.getElementById("brewPotionBtn");function b(){try{const t="btf_state_v1",e=localStorage.getItem(t);if(e){const t=JSON.parse(e);state.coins=t.coins??0,state.potionActive=t.potionActive??!1,state.potionEndsAt=t.potionEndsAt??0,state.luckStacks=t.luckStacks??0,state.bennyActive=t.bennyActive??!1,state.bennyEndsAt=t.bennyEndsAt??0,state.blessingActive=t.blessingActive??!1,state.blessingEndsAt=t.blessingEndsAt??0,state.purchasedItems=t.purchasedItems??[],state.bonusInventorySlots=t.bonusInventorySlots??0,state.fruits=t.fruits??{},state.tears=t.tears??0,state.potionInventory=t.potionInventory??[]}}catch(t){console.warn("load failed",t)}g()}function g(){if(coinsEl.textContent=state.coins,m&&(m.textContent=Math.floor(state.tears||0)),luckMultiplierEl){const t=state.potionActive&&state.potionEndsAt>Date.now(),e=Math.min(state.luckStacks,100);luckMultiplierEl.textContent=t?1+2*e+"x":"1x"}if(r){const t=state.bennyActive&&state.bennyEndsAt>Date.now();if(c.disabled=state.coins<n||t,t){const t=Math.ceil((state.bennyEndsAt-Date.now())/1e3),e=Math.floor(t/60),n=t%60;r.textContent=`${e}:${n.toString().padStart(2,"0")} remaining`,r.style.display="inline"}else r.style.display="none"}if(d){const t=state.blessingActive&&state.blessingEndsAt>Date.now();if(l&&(l.disabled=state.coins<s||t),t){const t=Math.ceil((state.blessingEndsAt-Date.now())/1e3),e=Math.floor(t/60),n=t%60;d.textContent=`${e}:${n.toString().padStart(2,"0")} remaining`,d.style.display="inline"}else d.style.display="none"}if(a.disabled=state.coins<t,state.potionActive){const e=Math.ceil((state.potionEndsAt-Date.now())/1e3);if(e<=0)state.potionActive=!1,state.potionEndsAt=0,state.luckStacks=0,saveState(),i.style.display="none",a.disabled=state.coins<t;else{const t=Math.floor(e/60),n=e%60;i.textContent=`${t}:${n.toString().padStart(2,"0")} remaining`,i.style.display="inline"}}else i.style.display="none";if(u){const t=(state.bonusInventorySlots||0)>=5;u.disabled=state.coins<o||t,u.textContent=t?"Purchased":"Buy Slot Machine"}if(y){const t=20,e=t+(state.bonusInventorySlots||0),n=(state.bonusInventorySlots||0)>=5;y.textContent=n?`Current capacity: ${e} slots (Slot Machine owned)`:`Current capacity: ${t} slots (base)`}}const A={common:1,rare:2,epic:4,special:5,legendary:6,spooky:8,chromatic:10,unique:15,godly:20},E={common:5,rare:20,epic:60,special:80,legendary:150,spooky:200,chromatic:300,unique:1e3,godly:5e3};function I(t){return FRUITS.find(e=>e.id===t)}function k(){if(!p)return;p.innerHTML="";const t=Object.entries(state.fruits||{}).filter(([,t])=>t>0);0!==t.length?t.forEach(([t,e])=>{const n=I(t),s=document.createElement("button");s.className="small",s.textContent=`${n?n.name:t} x${e}`,s.addEventListener("click",()=>function(t){const e=w.indexOf(t);e>=0?w.splice(e,1):w.length<3&&w.push(t),S()}(t)),p.appendChild(s)}):p.innerHTML='<div style="color:var(--muted)">No fruits available.</div>'}let w=[];function S(){if(!f||!h||!v)return;if(0===w.length)return f.textContent="No fruits selected.",h.textContent="",void(v.disabled=!0);const t=w.map(t=>{const e=I(t);return e?e.name:t}).join(", ");f.textContent=`Selected: ${t}`;let e=0,n=0;w.forEach(t=>{const s=I(t);s&&(e+=A[s.rarity]||0,n+=E[s.rarity]||0)}),e=Math.min(e,100),h.textContent=`Cost: ${n} Tears`;const s=(state.tears||0)>=n,o=w.every(t=>(state.fruits[t]||0)>0);v.disabled=!(s&&o),v.onclick=()=>async function(t,e){console.log("brewPotion called",{potency:t,cost:e,currentInventory:state.potionInventory}),w.forEach(t=>{state.fruits[t]>0&&(state.fruits[t]-=1,0===state.fruits[t]&&delete state.fruits[t])}),state.tears=Math.max(0,(state.tears||0)-e),Array.isArray(state.potionInventory)||(state.potionInventory=[]),state.potionInventory.push({type:"luck",name:"Brewed Luck Potion",potency:t,durationMs:3e5,createdAt:Date.now()}),console.log("After push",{newInventory:state.potionInventory,stateKeys:Object.keys(state)}),w=[],saveState(),console.log("After saveState"),g(),k(),"function"==typeof showAlert?await showAlert("âœ… Potion brewed successfully! Check your Inventory to use it."):alert("Potion brewed! Check your Inventory to use it.")}(e,n)}a.addEventListener("click",()=>{state.coins>=t&&(state.coins-=t,state.potionActive&&state.potionEndsAt>Date.now()?(state.luckStacks=Math.min(state.luckStacks+1,100),state.potionEndsAt=Date.now()+e):(state.potionActive=!0,state.luckStacks=1,state.potionEndsAt=Date.now()+e),state.purchasedItems.some(t=>"Potion of Luck"===t.name)||state.purchasedItems.push({name:"Potion of Luck",icon:"",description:"Makes all items 3x more common for 5 minutes"}),saveState(),g())}),c&&c.addEventListener("click",()=>{state.coins>=n&&!state.bennyActive&&(state.coins-=n,state.bennyActive=!0,state.bennyEndsAt=Date.now()+3e5,state.purchasedItems.some(t=>"Benny Boost"===t.name)||state.purchasedItems.push({name:"Happy Powder",icon:"ðŸ˜ƒ",description:"+5% CPS for 5 minutes"}),saveState(),g())}),l&&l.addEventListener("click",()=>{state.coins>=s&&!state.blessingActive&&(state.coins-=s,state.blessingActive=!0,state.blessingEndsAt=Date.now()+3e5,state.purchasedItems.some(t=>"Blessing of the Pumpkin"===t.name)||state.purchasedItems.push({name:"Blessing of the Pumpkin",icon:"ðŸŽƒ",description:"Makes spooky items 2/3 as rare for 5 minutes"}),saveState(),g())}),u&&u.addEventListener("click",()=>{(state.bonusInventorySlots||0)>=5?alert("You already own the Slot Machine."):state.coins>=o&&(state.coins-=o,state.bonusInventorySlots=5,state.purchasedItems.some(t=>"Slot Machine"===t.name)||state.purchasedItems.push({name:"Slot Machine",icon:"ðŸŽ°",description:"Adds +5 pet inventory slots permanently"}),saveState(),g(),alert(`Purchased! Your pet inventory capacity is now ${20+state.bonusInventorySlots} slots.`))});const C=document.getElementById("giftCodeInput"),B=document.getElementById("redeemGiftCode");B&&C&&(B.addEventListener("click",async()=>{const t=C.value.trim().toUpperCase();if(t)if("function"==typeof redeemGiftCode){const e=redeemGiftCode(t);e.success?(b(),g(),"function"==typeof showAlert?await showAlert("âœ… "+e.message):alert("âœ… "+e.message),C.value=""):"function"==typeof showAlert?await showAlert("âŒ "+e.message):alert("âŒ "+e.message)}else"function"==typeof showAlert?await showAlert("Gift code system not available. Please ensure you are on the correct page."):alert("Gift code system not available. Please ensure you are on the correct page.");else"function"==typeof showAlert?await showAlert("Please enter a gift code."):alert("Please enter a gift code.")}),C.addEventListener("keypress",t=>{"Enter"===t.key&&B.click()})),setInterval(g,1e3),b(),k(),S()}}]);