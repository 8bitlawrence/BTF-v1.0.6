(()=>{var e,t,n,i,o={},a={};function s(e){var t=a[e];if(void 0!==t)return t.exports;var n=a[e]={exports:{}};return o[e](n,n.exports,s),n.exports}s.m=o,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,s.t=function(n,i){if(1&i&&(n=this(n)),8&i)return n;if("object"==typeof n&&n){if(4&i&&n.__esModule)return n;if(16&i&&"function"==typeof n.then)return n}var o=Object.create(null);s.r(o);var a={};e=e||[null,t({}),t([]),t(t)];for(var r=2&i&&n;("object"==typeof r||"function"==typeof r)&&!~e.indexOf(r);r=t(r))Object.getOwnPropertyNames(r).forEach(e=>a[e]=()=>n[e]);return a.default=()=>n,s.d(o,a),o},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce((t,n)=>(s.f[n](e,t),t),[])),s.u=e=>e+".bundle.js",s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n={},i="btf-v1.0.6:",s.l=(e,t,o,a)=>{if(n[e])n[e].push(t);else{var r,l;if(void 0!==o)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var p=c[d];if(p.getAttribute("src")==e||p.getAttribute("data-webpack")==i+o){r=p;break}}r||(l=!0,(r=document.createElement("script")).charset="utf-8",s.nc&&r.setAttribute("nonce",s.nc),r.setAttribute("data-webpack",i+o),r.src=e),n[e]=[t];var u=(t,i)=>{r.onerror=r.onload=null,clearTimeout(m);var o=n[e];if(delete n[e],r.parentNode&&r.parentNode.removeChild(r),o&&o.forEach(e=>e(i)),t)return t(i)},m=setTimeout(u.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=u.bind(null,r.onerror),r.onload=u.bind(null,r.onload),l&&document.head.appendChild(r)}},s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var i=n.length-1;i>-1&&(!e||!/^http(s?):/.test(e));)e=n[i--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e})(),(()=>{var e={792:0};s.f.j=(t,n)=>{var i=s.o(e,t)?e[t]:void 0;if(0!==i)if(i)n.push(i[2]);else{var o=new Promise((n,o)=>i=e[t]=[n,o]);n.push(i[2]=o);var a=s.p+s.u(t),r=new Error;s.l(a,n=>{if(s.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var o=n&&("load"===n.type?"missing":n.type),a=n&&n.target&&n.target.src;r.message="Loading chunk "+t+" failed.\n("+o+": "+a+")",r.name="ChunkLoadError",r.type=o,r.request=a,i[1](r)}},"chunk-"+t,t)}};var t=(t,n)=>{var i,o,[a,r,l]=n,c=0;if(a.some(t=>0!==e[t])){for(i in r)s.o(r,i)&&(s.m[i]=r[i]);l&&l(s)}for(t&&t(n);c<a.length;c++)o=a[c],s.o(e,o)&&e[o]&&e[o][0](),e[o]=0},n=self.webpackChunkbtf_v1_0_6=self.webpackChunkbtf_v1_0_6||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();const r=[{id:"swift_1",name:"Swift I",tier:1,cost:50,description:"+2% Coins per Second"},{id:"lucky_1",name:"Lucky I",tier:1,cost:50,description:"3% chance to double coins on sells"},{id:"strong_1",name:"Strong I",tier:1,cost:50,description:"Sell Pets +5% coins"},{id:"resilient_1",name:"Resilient I",tier:1,cost:50,description:"Sell Fruits +5% coins"},{id:"wealthy_1",name:"Wealthy I",tier:1,cost:50,description:"+10% to all coin gains"},{id:"scavenger_1",name:"Scavenger I",tier:1,cost:50,description:"Capsule price -5%"},{id:"efficient_1",name:"Efficient I",tier:1,cost:50,description:"Pet roll price -5%"},{id:"durable_1",name:"Durable I",tier:1,cost:50,description:"+10% Coins per Second"},{id:"critical_1",name:"Critical I",tier:1,cost:50,description:"+5% extra double-sell chance"},{id:"vampiric_1",name:"Vampiric I",tier:1,cost:50,description:"Refund 2% of roll/capsule costs"},{id:"legendary_1",name:"Legendary I",tier:1,cost:75,description:"+5% all coin gains & CPS; -5% roll/capsule cost; +2% double-sell chance"},{id:"ultimate_1",name:"Ultimate I",tier:1,cost:75,description:"+2% all coin gains; -2% roll/capsule cost; +2% double-sell chance"},{id:"swift_2",name:"Swift II",tier:2,cost:150,description:"+5% Coins per Second"},{id:"lucky_2",name:"Lucky II",tier:2,cost:150,description:"8% chance to double coins on sells"},{id:"strong_2",name:"Strong II",tier:2,cost:150,description:"Sell Pets +12% coins"},{id:"resilient_2",name:"Resilient II",tier:2,cost:150,description:"Sell Fruits +12% coins"},{id:"wealthy_2",name:"Wealthy II",tier:2,cost:150,description:"+25% to all coin gains"},{id:"scavenger_2",name:"Scavenger II",tier:2,cost:150,description:"Capsule price -12%"},{id:"efficient_2",name:"Efficient II",tier:2,cost:150,description:"Pet roll price -12%"},{id:"durable_2",name:"Durable II",tier:2,cost:150,description:"+25% Coins per Second"},{id:"critical_2",name:"Critical II",tier:2,cost:150,description:"+10% extra double-sell chance"},{id:"vampiric_2",name:"Vampiric II",tier:2,cost:150,description:"Refund 5% of roll/capsule costs"},{id:"swift_3",name:"Swift III",tier:3,cost:400,description:"+10% Coins per Second"},{id:"lucky_3",name:"Lucky III",tier:3,cost:400,description:"15% chance to double coins on sells"},{id:"strong_3",name:"Strong III",tier:3,cost:400,description:"Sell Pets +25% coins"},{id:"resilient_3",name:"Resilient III",tier:3,cost:400,description:"Sell Fruits +25% coins"},{id:"wealthy_3",name:"Wealthy III",tier:3,cost:400,description:"+50% to all coin gains"},{id:"scavenger_3",name:"Scavenger III",tier:3,cost:400,description:"Capsule price -20%"},{id:"efficient_3",name:"Efficient III",tier:3,cost:400,description:"Pet roll price -20%"},{id:"durable_3",name:"Durable III",tier:3,cost:400,description:"+50% Coins per Second"},{id:"critical_3",name:"Critical III",tier:3,cost:400,description:"+20% extra double-sell chance"},{id:"vampiric_3",name:"Vampiric III",tier:3,cost:400,description:"Refund 12% of roll/capsule costs"},{id:"legendary_3",name:"Legendary III",tier:3,cost:500,description:"+10% all coin gains & CPS; -10% roll/capsule cost; +5% double-sell chance"},{id:"ultimate_3",name:"Ultimate III",tier:3,cost:500,description:"+5% all coin gains; -5% roll/capsule cost; +5% double-sell chance"},{id:"mage_1",name:"Mage I",tier:1,cost:50,description:"+25% EP generation (Suspicious Creature only)",exclusiveTo:"pet_sp_1"},{id:"mage_2",name:"Mage II",tier:2,cost:150,description:"+50% EP generation (Suspicious Creature only)",exclusiveTo:"pet_sp_1"},{id:"mage_3",name:"Mage III",tier:3,cost:400,description:"+100% EP generation (Suspicious Creature only)",exclusiveTo:"pet_sp_1"}],l={1:1,2:.4,3:.15};r.forEach(e=>{e.weight=l[e.tier]??1});const c=[{id:"pet_c_1",name:"Dirt Fox",rarity:"common",weight:50,value:20},{id:"pet_c_2",name:"Dirt Finch",rarity:"common",weight:50,value:20},{id:"pet_c_3",name:"Dirt Turtle",rarity:"common",weight:50,value:25},{id:"pet_r_1",name:"Dusk Fox",rarity:"rare",weight:25,value:150},{id:"pet_r_2",name:"Aero Lynx",rarity:"rare",weight:25,value:160},{id:"pet_e_1",name:"Nebula Kirin",rarity:"epic",weight:10,value:800},{id:"pet_u_1",name:"Singularity Phoenix",rarity:"unique",weight:.005,value:1e7},{id:"pet_u_2",name:"Timekeeper Dragon",rarity:"unique",weight:.005,value:1e7},{id:"pet_sp_1",name:"Suspicious Creature",rarity:"special",weight:1,value:1e3},{id:"pet_sp_2",name:"Weeping Spirit",rarity:"special",weight:80,value:1200},{id:"pet_l_1",name:"Infinity Golem",rarity:"legendary",weight:.5,value:1200},{id:"pet_s_1",name:"Nightmare Skeleton",rarity:"spooky",weight:.3,value:2500},{id:"pet_ch_1",name:"Chroma Beast",rarity:"chromatic",weight:.25,value:5e3},{id:"pet_s_2",name:"Spooky Ghost",rarity:"spooky",weight:.3,value:2200},{id:"pet_u_3",name:"Max Verstappen",rarity:"unique",weight:.005,value:1e7},{id:"pet_g_1",name:"Celestial Archon",rarity:"godly",weight:5e-4,value:5e7}];function d(){return 20+(y.bonusInventorySlots||0)}const p={HIVIHAAN67676767:{pet:["pet_ch_1","pet_ch_1","pet_ch_1","pet_s_1","pet_s_2"],description:"3x Chromabeasts and both spooky pets"},OBLIVIOUS6767676:{pet:["pet_u_3","pet_sp_1","pet_sp_1","pet_sp_1","pet_sp_2","pet_u_3","pet_ch_1","pet_ch_1","pet_ch_1","pet_ch_1","pet_ch_1","pet_ch_1","pet_u_2","pet_u_1","pet_s_1","pet_1"],description:"5,000 Tears"}},u=function(){const e=(new Date).getFullYear();return new Date(e,10,1).getTime()}(),m=[{id:"fruit_c_1",name:"Sandfruit",rarity:"common",weight:50,value:5},{id:"fruit_c_2",name:"Fireberry",rarity:"common",weight:50,value:5},{id:"fruit_r_1",name:"Golden Apple",rarity:"rare",weight:35,value:30},{id:"fruit_e_1",name:"Starfruit",rarity:"epic",weight:10,value:150},{id:"fruit_l_1",name:"Eternal Mango",rarity:"legendary",weight:.5,value:200},{id:"fruit_c_3",name:"Dirtfruit",rarity:"common",weight:50,value:5},{id:"fruit_c_4",name:"Watermelon",rarity:"common",weight:50,value:5},{id:"fruit_ch_1",name:"Chromafruit",rarity:"chromatic",weight:.25,value:1200},{id:"fruit_r_2",name:"Lunar Melon",rarity:"rare",weight:35,value:30},{id:"fruit_e_2",name:"Solar Melon",rarity:"epic",weight:10,value:150},{id:"fruit_l_2",name:"Mythic Pineapple",rarity:"legendary",weight:.5,value:200},{id:"fruit_ch_2",name:"Positive Potato",rarity:"chromatic",weight:.25,value:1200},{id:"fruit_l_3",name:"Negative Potato",rarity:"legendary",weight:.5,value:500},{id:"fruit_u_1",name:"Aurora Berry",rarity:"unique",weight:.005,value:6e7},{id:"fruit_u_2",name:"Cookiefruit",rarity:"unique",weight:.005,value:6e7},{id:"fruit_s_1",name:"Cursed Pumpkin",rarity:"spooky",weight:.3,value:800},{id:"fruit_g_1",name:"Omnifruit",rarity:"godly",weight:5e-4,value:1e8}];let y={coins:2e3,enchantPoints:0,inventory:{},fruits:{},petEnchantments:{},petNames:{},potionActive:!1,potionEndsAt:0,luckStacks:0,bennyActive:!1,bennyEndsAt:0,bonusInventorySlots:0,redeemedGiftCodes:[],petRerollsUsed:{},tears:0,potionInventory:[]};const f={common:1,rare:2,epic:3,special:4,legendary:5,spooky:6,chromatic:7,unique:8,godly:9},g=document.getElementById("coins"),h=document.getElementById("tearsDisplayMain"),v=document.getElementById("cps"),b=document.getElementById("epDisplay"),_=document.getElementById("eps"),w=document.getElementById("luckMultiplier"),E=document.getElementById("singleRoll"),C=document.getElementById("tenRoll"),I=document.getElementById("resultArea"),x=document.getElementById("inventoryListPets"),S=document.getElementById("clearInv"),k=document.getElementById("inventoryListFruits"),M=document.getElementById("clearFruits"),L=document.getElementById("capSingle"),P=document.getElementById("capTen"),$=document.getElementById("capsuleResultArea"),A="btf_state_v1",N=A+"_hash";function T(e){return null===e||"object"!=typeof e?JSON.stringify(e):Array.isArray(e)?"["+e.map(e=>T(e)).join(",")+"]":"{"+Object.keys(e).sort().map(t=>JSON.stringify(t)+":"+T(e[t])).join(",")+"}"}function D(e){const t=function(e){return{coins:e.coins||0,enchantPoints:e.enchantPoints||0,inventory:e.inventory||{},fruits:e.fruits||{},petEnchantments:e.petEnchantments||{},petNames:e.petNames||{},bonusInventorySlots:e.bonusInventorySlots||0,redeemedGiftCodes:e.redeemedGiftCodes||[],petRerollsUsed:e.petRerollsUsed||{},tears:e.tears||0,potionInventory:Array.isArray(e.potionInventory)?e.potionInventory.slice(0,50):[]}}(e);return function(e){let t=0xcbf29ce484222325n;for(let n=0;n<e.length;n++)t^=BigInt(255&e.charCodeAt(n)),t=1099511628211n*t&0xffffffffffffffffn;let n=t.toString(16);for(;n.length<16;)n="0"+n;return n}(T(t))}function B(){try{const e=JSON.stringify(y);localStorage.setItem(A,e);const t=D(y);localStorage.setItem(N,t)}catch(e){console.warn(e)}}function O(e){const t=y.potionActive&&y.potionEndsAt>Date.now(),n=Math.min(y.luckStacks,100),i=t?1+2*n:1,o=Date.now()<u;let a=e.filter(e=>!("spooky"===e.rarity&&!o));const s={common:1,rare:2,epic:4,special:3,legendary:8,spooky:6,chromatic:10,unique:12,godly:15},r=a.map(e=>{let n=e.weight;if(t){const t=s[e.rarity]||1;n=e.weight*(1+(i-1)*t)}return n}),l=r.reduce((e,t)=>e+t,0);let c=Math.random()*l;for(let e=0;e<a.length;e++){const t=a[e],n=r[e];if(c<n)return t;c-=n}return a[a.length-1]}const R={common:1,rare:3,epic:8,special:12,legendary:20,spooky:30,chromatic:80,unique:120,godly:200};function G(){const e={coinGainMult:1,cpsMult:1,sellPetMult:1,sellFruitMult:1,rollDiscount:0,capDiscount:0,doubleSellChance:0,spendRefundPercent:0,epGenerationMult:1},t=y.petEnchantments||{};for(const[n,i]of Object.entries(t)){const t=n.split("_").slice(0,-1).join("_"),o=parseInt(n.split("_").pop());if(y.inventory[t]&&!(o>=y.inventory[t]))for(const t of i)switch(t){case"wealthy_1":e.coinGainMult*=1.1;break;case"wealthy_2":e.coinGainMult*=1.25;break;case"wealthy_3":e.coinGainMult*=1.5;break;case"swift_1":e.cpsMult*=1.02;break;case"swift_2":e.cpsMult*=1.05;break;case"swift_3":case"durable_1":e.cpsMult*=1.1;break;case"durable_2":e.cpsMult*=1.25;break;case"durable_3":e.cpsMult*=1.5;break;case"strong_1":e.sellPetMult*=1.05;break;case"strong_2":e.sellPetMult*=1.12;break;case"strong_3":e.sellPetMult*=1.25;break;case"resilient_1":e.sellFruitMult*=1.05;break;case"resilient_2":e.sellFruitMult*=1.12;break;case"resilient_3":e.sellFruitMult*=1.25;break;case"efficient_1":e.rollDiscount+=.05;break;case"efficient_2":e.rollDiscount+=.12;break;case"efficient_3":e.rollDiscount+=.2;break;case"scavenger_1":e.capDiscount+=.05;break;case"scavenger_2":e.capDiscount+=.12;break;case"scavenger_3":e.capDiscount+=.2;break;case"lucky_1":e.doubleSellChance+=.03;break;case"lucky_2":e.doubleSellChance+=.08;break;case"lucky_3":e.doubleSellChance+=.15;break;case"critical_2":e.doubleSellChance+=.1;break;case"critical_3":e.doubleSellChance+=.2;break;case"vampiric_2":e.spendRefundPercent+=.05;break;case"vampiric_3":e.spendRefundPercent+=.12;break;case"legendary_3":e.coinGainMult*=1.1,e.cpsMult*=1.1,e.sellPetMult*=1.1,e.sellFruitMult*=1.1,e.rollDiscount+=.1,e.capDiscount+=.1,e.doubleSellChance+=.05,e.spendRefundPercent+=.05;break;case"ultimate_3":e.coinGainMult*=1.05,e.rollDiscount+=.05,e.capDiscount+=.05,e.doubleSellChance+=.05;break;case"mage_1":e.epGenerationMult*=1.25;break;case"mage_2":e.epGenerationMult*=1.5;break;case"mage_3":e.epGenerationMult*=2}}return e.rollDiscount=Math.min(.5,e.rollDiscount),e.capDiscount=Math.min(.5,e.capDiscount),e.doubleSellChance=Math.min(.9,e.doubleSellChance),e}function j(){const e=G();return{priceSingle:Math.max(1,Math.ceil(100*(1-e.rollDiscount))),priceTen:Math.max(1,Math.ceil(900*(1-e.rollDiscount))),capSingle:Math.max(1,Math.ceil(20*(1-e.capDiscount))),capTen:Math.max(1,Math.ceil(180*(1-e.capDiscount))),_effects:e}}function F(){let e=0;for(const[t,n]of Object.entries(y.inventory)){const i=c.find(e=>e.id===t);i&&(e+=(R[i.rarity]||0)*n)}const t=G();return e=Math.floor(e*t.cpsMult),y.bennyActive&&y.bennyEndsAt>Date.now()?Math.floor(1.05*e):e}function q(){return O(c)}function H(){return O(m)}function U(){if(g&&(g.textContent=y.coins),h&&(h.textContent=Math.floor(y.tears||0)),v){const e=F();v.textContent=`(+${e}/s)`}if(b&&(b.textContent=y.enchantPoints),_){let e=0;for(const[t,n]of Object.entries(y.inventory)){const i=c.find(e=>e.id===t);i&&"special"===i.rarity&&(e+=n)}const t=.5*e*G().epGenerationMult,n=Number.isInteger(t)?t:t.toFixed(1);_.textContent=`(+${n}/s)`}if(w){const e=y.potionActive&&y.potionEndsAt>Date.now(),t=Math.min(y.luckStacks,100);w.textContent=e?1+2*t+"x":"1x"}if(E&&C&&L&&P){const e=j();E.textContent=`Open x1 (${e.priceSingle}c)`,C.textContent=`Open x10 (${e.priceTen}c)`,L.textContent=`Open Capsule x1 (${e.capSingle}c)`,P.textContent=`Open Capsule x10 (${e.capTen}c)`}if(x){x.innerHTML="";const e=Object.entries(y.inventory).sort((e,t)=>t[1]-e[1]);if(0===e.length)x.innerHTML='<div style="color:var(--muted)">No pets yet. Roll to get some!</div>';else for(const[t,n]of e){const e=c.find(e=>e.id===t)||{name:t,rarity:"common",value:5},i=document.createElement("div");i.className="inventory-item",i.style.cursor="pointer",y.bennyActive&&y.bennyEndsAt>Date.now()&&i.classList.add("benny-glow"),"chromatic"===e.rarity?i.classList.add("chromatic"):"spooky"===e.rarity?i.classList.add("spooky"):"unique"===e.rarity?i.classList.add("unique"):"godly"===e.rarity&&i.classList.add("godly");const o=document.createElement("div");o.className=`badge ${e.rarity}`,o.textContent=e.rarity.toUpperCase();const a=document.createElement("div");a.innerHTML=`<div style="font-weight:700">${e.name}</div><div style="color:var(--muted);font-size:12px">x${n} â€¢ Sell: ${e.value}c</div>`;const s=(R[e.rarity]||0)*n,r=document.createElement("div");r.style.color="var(--muted)",r.style.fontSize="12px",r.textContent=`CPS: ${s}`,a.appendChild(r);const l=document.createElement("button");l.className="sell-btn small",l.textContent="Sell x1",l.addEventListener("click",async e=>{e.stopPropagation(),await Q(t,1)});const d=document.createElement("button");d.className="sell-btn small",d.textContent="Sell All",d.addEventListener("click",async e=>{e.stopPropagation(),await Q(t,y.inventory[t])});const p=document.createElement("div");p.style.marginLeft="auto",p.appendChild(l),p.appendChild(d),i.appendChild(o),i.appendChild(a),i.appendChild(p),i.addEventListener("click",()=>ee(t,n)),x.appendChild(i)}}if(k){k.innerHTML="";const e=Object.entries(y.fruits).sort((e,t)=>t[1]-e[1]);if(0===e.length)k.innerHTML='<div style="color:var(--muted)">No fruits yet. Roll capsules to collect fruits.</div>';else for(const[t,n]of e){const e=m.find(e=>e.id===t)||{name:t,rarity:"common",value:1},i=document.createElement("div");i.className="inventory-item",y.bennyActive&&y.bennyEndsAt>Date.now()&&i.classList.add("benny-glow"),y.bennyActive&&y.bennyEndsAt>Date.now()&&i.classList.add("benny-glow"),"chromatic"===e.rarity?i.classList.add("chromatic"):"spooky"===e.rarity?i.classList.add("spooky"):"unique"===e.rarity?i.classList.add("unique"):"godly"===e.rarity&&i.classList.add("godly");const o=document.createElement("div");o.className=`badge ${e.rarity}`,o.textContent=e.rarity.toUpperCase();const a=document.createElement("div");a.innerHTML=`<div style="font-weight:700">${e.name}</div><div style="color:var(--muted);font-size:12px">x${n} â€¢ Sell: ${e.value}c</div>`;const s=document.createElement("button");s.className="sell-btn small",s.textContent="Sell x1",s.addEventListener("click",async()=>{await X(t,1)});const r=document.createElement("button");r.className="sell-btn small",r.textContent="Sell All",r.addEventListener("click",async()=>{await X(t,y.fruits[t])});const l=document.createElement("div");l.style.marginLeft="auto",l.appendChild(s),l.appendChild(r),i.appendChild(o),i.appendChild(a),i.appendChild(l),k.appendChild(i)}}}function z(e,t){E&&(E.disabled=!0),C&&(C.disabled=!0),L&&(L.disabled=!0),P&&(P.disabled=!0),E&&E.classList.add("anim-pulse"),C&&C.classList.add("anim-pulse"),I&&I.classList.add("animating"),$&&$.classList.add("animating"),setTimeout(()=>{const n=e();t===J&&(I.innerHTML=""),t===K&&($.innerHTML=""),n.forEach((e,n)=>{setTimeout(()=>{const n=document.createElement("div");n.className=`result-card rarity-${e.rarity} pop`,t===J&&y.bennyActive&&y.bennyEndsAt>Date.now()&&n.classList.add("benny-glow");const i=document.createElement("div");i.style.fontSize="28px","godly"===e.rarity?(i.textContent="âš¡",n.classList.add("godly")):"spooky"===e.rarity?(i.textContent="ðŸŽƒ",n.classList.add("spooky")):"unique"===e.rarity?(i.textContent="ðŸ‘‘",n.classList.add("unique")):"epic"===e.rarity?(i.textContent="âœ¨",n.classList.add("epic")):"special"===e.rarity?(i.textContent="ðŸ‘ï¸",n.classList.add("special")):"chromatic"===e.rarity?(i.textContent="ðŸŒˆ",n.classList.add("chromatic")):"legendary"===e.rarity?i.textContent="ðŸ”±":"rare"===e.rarity?i.textContent="â­":i.textContent="â—";const o=document.createElement("div");o.className="pet-name",o.textContent=e.name,n.appendChild(i),n.appendChild(o),t===J&&I.appendChild(n),t===K&&$.appendChild(n),setTimeout(()=>{n.classList.add("reveal-glow")},80)},160*n)}),setTimeout(async()=>{await t(n),E&&(E.disabled=!1),C&&(C.disabled=!1),L&&(L.disabled=!1),P&&(P.disabled=!1),E&&E.classList.remove("anim-pulse"),C&&C.classList.remove("anim-pulse"),I&&I.classList.remove("animating"),$&&$.classList.remove("animating")},160*n.length+220)},220)}function V(e){return new Promise(t=>{const n=document.createElement("div");n.style.position="fixed",n.style.left="0",n.style.top="0",n.style.right="0",n.style.bottom="0",n.style.background="rgba(0,0,0,0.45)",n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",n.style.zIndex="9999";const i=document.createElement("div");i.style.width="min(420px, 92%)",i.style.background="var(--modal-bg, #1f2937)",i.style.color="var(--modal-fg, #fff)",i.style.borderRadius="10px",i.style.boxShadow="0 8px 24px rgba(0,0,0,0.35)",i.style.padding="18px",i.style.display="flex",i.style.flexDirection="column",i.style.gap="12px";const o=document.createElement("div");o.style.fontSize="15px",o.style.lineHeight="1.4",o.style.color="var(--modal-fg, #fff)",o.textContent=e;const a=document.createElement("div");a.style.display="flex",a.style.justifyContent="flex-end";const s=document.createElement("button");function r(){document.body.removeChild(n),document.removeEventListener("keydown",l),t()}function l(e){"Escape"===e.key&&r()}s.textContent="OK",s.style.padding="8px 14px",s.style.borderRadius="8px",s.style.border="none",s.style.cursor="pointer",s.style.background="var(--accent, #3b82f6)",s.style.color="white",a.appendChild(s),i.appendChild(o),i.appendChild(a),n.appendChild(i),document.body.appendChild(n),s.addEventListener("click",r),n.addEventListener("click",e=>{e.target===n&&r()}),document.addEventListener("keydown",l)})}function Y(e){return new Promise(t=>{const n=document.createElement("div");n.style.position="fixed",n.style.left="0",n.style.top="0",n.style.right="0",n.style.bottom="0",n.style.background="rgba(0,0,0,0.45)",n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",n.style.zIndex="9999";const i=document.createElement("div");i.style.width="min(520px, 94%)",i.style.background="var(--modal-bg, #1f2937)",i.style.color="var(--modal-fg, #fff)",i.style.borderRadius="10px",i.style.boxShadow="0 8px 24px rgba(0,0,0,0.35)",i.style.padding="18px",i.style.display="flex",i.style.flexDirection="column",i.style.gap="12px";const o=document.createElement("div");o.style.fontSize="15px",o.style.lineHeight="1.4",o.style.color="var(--modal-fg, #fff)",o.textContent=e;const a=document.createElement("div");a.style.display="flex",a.style.justifyContent="flex-end",a.style.gap="8px";const s=document.createElement("button");s.textContent="Cancel",s.style.padding="8px 12px",s.style.borderRadius="8px",s.style.border="1px solid rgba(255,255,255,0.08)",s.style.cursor="pointer",s.style.color="var(--modal-fg, #fff)",s.style.background="transparent";const r=document.createElement("button");function l(e){document.body.removeChild(n),document.removeEventListener("keydown",c),t(e)}function c(e){"Escape"===e.key&&l(!1)}r.textContent="OK",r.style.padding="8px 14px",r.style.borderRadius="8px",r.style.border="none",r.style.cursor="pointer",r.style.background="var(--accent, #3b82f6)",r.style.color="white",a.appendChild(s),a.appendChild(r),i.appendChild(o),i.appendChild(a),n.appendChild(i),document.body.appendChild(n),s.addEventListener("click",()=>l(!1)),r.addEventListener("click",()=>l(!0)),n.addEventListener("click",e=>{e.target===n&&l(!1)}),document.addEventListener("keydown",c)})}function W(){return Object.values(y.inventory).reduce((e,t)=>e+t,0)}async function J(e){I.innerHTML="";let t=0,n=d()-W();for(const i of e){const e=document.createElement("div");e.className=`result-card rarity-${i.rarity}`;const o=document.createElement("div");o.style.fontSize="28px","godly"===i.rarity?(o.textContent="âš¡",e.classList.add("godly")):"chromatic"===i.rarity?(o.textContent="ðŸŒˆ",e.classList.add("chromatic")):"spooky"===i.rarity?(o.textContent="ðŸŽƒ",e.classList.add("spooky")):"unique"===i.rarity?(o.textContent="ðŸ‘‘",e.classList.add("unique")):"epic"===i.rarity?(o.textContent="âœ¨",e.classList.add("epic")):"special"===i.rarity?(o.textContent="ðŸ‘ï¸",e.classList.add("special")):"legendary"===i.rarity?o.textContent="ðŸ”±":"rare"===i.rarity?o.textContent="â­":o.textContent="â—",document.createElement("div").className="inventory-item",n>0?(y.inventory[i.id]=(y.inventory[i.id]||0)+1,n--):t++}B(),U(),t>0&&await V(`Inventory full â€” ${t} item(s) were not added. Sell pets to free space or buy BTF+ for an inventory size of 50.`)}function K(e){$.innerHTML="";for(const t of e){const e=document.createElement("div");e.className=`result-card rarity-${t.rarity}`;const n=document.createElement("div");n.style.fontSize="28px","godly"===t.rarity?(n.textContent="âš¡",e.classList.add("godly")):"chromatic"===t.rarity?(n.textContent="ðŸŒˆ",e.classList.add("chromatic")):"spooky"===t.rarity?(n.textContent="ðŸŽƒ",e.classList.add("spooky")):"unique"===t.rarity?(n.textContent="ðŸ‘‘",e.classList.add("unique")):"epic"===t.rarity?(n.textContent="âœ¨",e.classList.add("epic")):"legendary"===t.rarity?n.textContent="ðŸ”±":"rare"===t.rarity?n.textContent="â­":n.textContent="â—";const i=document.createElement("div");i.className="pet-name",i.textContent=t.name,e.appendChild(n),e.appendChild(i),$.appendChild(e),y.fruits[t.id]=(y.fruits[t.id]||0)+1}B(),U()}async function X(e,t){const n=y.fruits[e]||0;if(!n)return;const i=Math.min(n,t),o=m.find(t=>t.id===e)||{value:1};if((f[o.rarity]??0)>=f.legendary&&!await Y(`Sell ${i} ${o.name}${i>1?"s":""}? This item is ${o.rarity.toUpperCase()}.`))return;let a=(o.value||1)*i;const s=G();Math.random()<s.doubleSellChance&&(a*=2),a=Math.floor(a*s.sellFruitMult*s.coinGainMult),y.fruits[e]=n-i,y.fruits[e]<=0&&delete y.fruits[e],y.coins+=a,B(),U()}async function Q(e,t){const n=y.inventory[e]||0;if(!n)return;if(1===t&&n>1)return void function(e){const t=y.inventory[e]||0;if(t<=0)return;const n=c.find(t=>t.id===e);if(!n)return;const i=document.getElementById("sellPetModal"),o=document.getElementById("sellPetTitle"),a=document.getElementById("sellPetList");o.textContent=`Select ${n.name} to Sell`,a.innerHTML="";for(let i=0;i<t;i++){const t=`${e}_${i}`,o=y.petNames[t],s=y.petEnchantments[t]||[],l=document.createElement("div");l.className="pet-selector-item",l.style.cursor="pointer",l.style.padding="14px",l.style.background="var(--glass)",l.style.borderRadius="8px",l.style.border="2px solid rgba(255,255,255,0.08)",l.style.transition="all 0.2s";const c=o||`${n.name} #${i+1}`,d=R[n.rarity]||0;let p="";s.length>0&&(p=`<div style="font-size:12px;color:#a855f7;margin-top:4px">ðŸ’Ž ${s.map(e=>{const t=r.find(t=>t.id===e);return t?t.name:e}).join(", ")}</div>`),l.innerHTML=`\n\t\t\t<div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:6px">\n\t\t\t\t<div style="font-weight:700;font-size:15px">${c}</div>\n\t\t\t\t<div class="badge ${n.rarity}" style="font-size:10px;padding:3px 8px">${n.rarity.toUpperCase()}</div>\n\t\t\t</div>\n\t\t\t<div style="font-size:13px;color:var(--muted);margin-bottom:4px">\n\t\t\t\t${s.length} enchantment${1!==s.length?"s":""} â€¢ ${d} CPS â€¢ Sell: ${n.value}c\n\t\t\t</div>\n\t\t\t${p}\n\t\t`,l.addEventListener("mouseenter",()=>{l.style.borderColor="#ef4444",l.style.background="rgba(239, 68, 68, 0.1)",l.style.transform="translateX(4px)"}),l.addEventListener("mouseleave",()=>{l.style.borderColor="rgba(255,255,255,0.08)",l.style.background="var(--glass)",l.style.transform="translateX(0)"}),l.addEventListener("click",()=>{Z(e,i)}),a.appendChild(l)}i.style.display="flex"}(e);const i=Math.min(n,t),o=c.find(t=>t.id===e)||{value:1};if((f[o.rarity]??0)>=f.legendary&&!await Y(`Sell ${i} ${o.name}${i>1?"s":""}? This pet is ${o.rarity.toUpperCase()}.`))return;let a=(o.value||1)*i;const s=G();if(Math.random()<s.doubleSellChance&&(a*=2),a=Math.floor(a*s.sellPetMult*s.coinGainMult),y.inventory[e]=n-i,y.inventory[e]<=0&&delete y.inventory[e],void 0===y.inventory[e]||y.inventory[e]<=0)for(let t=0;t<n;t++){const n=`${e}_${t}`;delete y.petEnchantments[n],delete y.petNames[n]}y.coins+=a,B(),U()}async function Z(e,t){const n=y.inventory[e]||0;if(!n||t>=n)return;const i=c.find(t=>t.id===e)||{value:1};if((f[i.rarity]??0)>=f.legendary){const n=`${e}_${t}`,o=y.petNames[n]||`${i.name} #${t+1}`;if(!await Y(`Sell ${o}? This pet is ${i.rarity.toUpperCase()}.`))return}let o=i.value||1;const a=G();Math.random()<a.doubleSellChance&&(o*=2),o=Math.floor(o*a.sellPetMult*a.coinGainMult);const s=`${e}_${t}`;delete y.petEnchantments[s],delete y.petNames[s];for(let i=t+1;i<n;i++){const t=`${e}_${i}`,n=`${e}_${i-1}`;y.petEnchantments[t]&&(y.petEnchantments[n]=y.petEnchantments[t],delete y.petEnchantments[t]),y.petNames[t]&&(y.petNames[n]=y.petNames[t],delete y.petNames[t])}y.inventory[e]=n-1,y.inventory[e]<=0&&delete y.inventory[e],y.coins+=o,B(),U();const r=document.getElementById("sellPetModal");r&&(r.style.display="none")}function ee(e,t){const n=c.find(t=>t.id===e);if(!n)return;const i=document.getElementById("petSelectorModal"),o=document.getElementById("petSelectorTitle"),a=document.getElementById("petSelectorList");o.textContent=`Select ${n.name} to View`,a.innerHTML="";for(let o=0;o<t;o++){const t=`${e}_${o}`,s=y.petNames[t],l=y.petEnchantments[t]||[],c=document.createElement("div");c.className="pet-selector-item",c.style.cursor="pointer",c.style.padding="12px",c.style.background="var(--glass)",c.style.borderRadius="8px",c.style.border="1px solid rgba(255,255,255,0.08)",c.style.transition="all 0.2s";const d=s||`${n.name} #${o+1}`;let p="";l.length>0&&(p=`<div style="font-size:12px;color:#a855f7;margin-top:4px">ðŸ’Ž ${l.map(e=>{const t=r.find(t=>t.id===e);return t?t.name:e}).join(", ")}</div>`),c.innerHTML=`\n\t\t\t<div style="font-weight:700;font-size:15px;margin-bottom:4px">${d}</div>\n\t\t\t<div style="font-size:13px;color:var(--muted)">${l.length} enchantment${1!==l.length?"s":""}</div>\n\t\t\t${p}\n\t\t`,c.addEventListener("mouseenter",()=>{c.style.borderColor="var(--accent)",c.style.transform="translateX(4px)"}),c.addEventListener("mouseleave",()=>{c.style.borderColor="rgba(255,255,255,0.08)",c.style.transform="translateX(0)"}),c.addEventListener("click",()=>{i.style.display="none",te(e,o)}),a.appendChild(c)}i.style.display="flex"}function te(e,t){const n=c.find(t=>t.id===e);if(!n)return;const i=`${e}_${t}`,o=y.petEnchantments[i]||[],a=y.petNames[i],s=document.getElementById("petInfoModal"),l=document.getElementById("petInfoName"),d=document.getElementById("petInfoDetails"),p=document.getElementById("petInfoEnchants"),u=document.getElementById("petRenameInput"),m=document.getElementById("petRenameBtn"),f=a||`${n.name} #${t+1}`;l.textContent=f;const g=R[n.rarity]||0;d.innerHTML=`\n\t\t<div class="badge ${n.rarity}">${n.rarity.toUpperCase()}</div>\n\t\t<p style="margin:8px 0 4px 0"><strong>Coins per Second:</strong> ${g}</p>\n\t\t<p style="margin:4px 0"><strong>Sell Value:</strong> ${n.value} coins</p>\n\t\t<p style="margin:4px 0;font-size:12px;color:var(--muted)">Instance: #${t+1}</p>\n\t`,p.innerHTML="",0===o.length?p.innerHTML='<p style="color:var(--muted);font-size:13px">No enchantments yet. Visit the Enchanting page to add enchantments!</p>':o.forEach(e=>{const t=r.find(t=>t.id===e);if(t){const e=document.createElement("div");e.className=`enchant-badge enchant-tier-${t.tier}`,e.innerHTML=`<div style="font-weight:700">${t.name}</div><div style="font-size:11px;opacity:0.9">${t.description}</div>`,p.appendChild(e)}}),u.value=a||"",u.placeholder=`${n.name} #${t+1}`;const h=m.cloneNode(!0);m.parentNode.replaceChild(h,m),h.addEventListener("click",()=>{const n=u.value.trim();n?y.petNames[i]=n:delete y.petNames[i],B(),U(),te(e,t)}),s.style.display="flex"}function ne(){const e=document.querySelector(".halloween-shimmer"),t=document.querySelector(".subtitle"),n=Date.now()<u;(e||t)&&(n?(e&&e.classList.add("halloween-shimmer"),t&&(t.style.display="")):(e&&(e.classList.remove("halloween-shimmer"),e.style.color=""),t&&(t.style.display="none")))}E&&E.addEventListener("click",async()=>{const e=j();if(y.coins<e.priceSingle)return void alert("Not enough coins for a single roll.");const t=d();if(W()>=t)return void await V(`Your pet inventory is full (${t}). Sell some pets before rolling.`);y.coins-=e.priceSingle;const n=e._effects;if(n.spendRefundPercent>0){const t=Math.floor(e.priceSingle*n.spendRefundPercent*n.coinGainMult);y.coins+=t}const i=1+Math.floor(1*Math.random());y.enchantPoints=(y.enchantPoints||0)+i,z(()=>[q()],J)}),C&&C.addEventListener("click",async()=>{const e=j();if(y.coins<e.priceTen)return void alert("Not enough coins for a ten-roll.");const t=d(),n=t-W();if(n<=0)return void await V(`Your pet inventory is full (${t}). Sell some pets before rolling.`);if(n<10&&!await Y(`You only have space for ${n} more pet(s). Rolling x10 may discard the extra ${10-n} pet(s). Continue?`))return;y.coins-=e.priceTen;const i=e._effects;if(i.spendRefundPercent>0){const t=Math.floor(e.priceTen*i.spendRefundPercent*i.coinGainMult);y.coins+=t}const o=5+Math.floor(6*Math.random());y.enchantPoints=(y.enchantPoints||0)+o,z(()=>function(){const e=[];for(let t=0;t<9;t++)e.push(q());if(e.some(e=>["rare","legendary","epic","chromatic"].includes(e.rarity)))e.push(q());else{const t=Date.now()<u,n=c.filter(e=>["rare","legendary","epic","special","chromatic"].concat(t?["spooky"]:[]).includes(e.rarity));e.push(O(n))}return e}(),J)}),L&&L.addEventListener("click",()=>{const e=j();if(y.coins<e.capSingle)return void alert("Not enough coins for capsule roll.");y.coins-=e.capSingle;const t=e._effects;if(t.spendRefundPercent>0){const n=Math.floor(e.capSingle*t.spendRefundPercent*t.coinGainMult);y.coins+=n}z(()=>[H()],K)}),P&&P.addEventListener("click",()=>{const e=j();if(y.coins<e.capTen)return void alert("Not enough coins for capsule x10.");y.coins-=e.capTen;const t=e._effects;if(t.spendRefundPercent>0){const n=Math.floor(e.capTen*t.spendRefundPercent*t.coinGainMult);y.coins+=n}z(()=>function(){const e=[];for(let t=0;t<10;t++)e.push(H());return e}(),K)}),S&&S.addEventListener("click",async()=>{await Y("Clear your inventory?")&&(y.inventory={},B(),U())}),M&&M.addEventListener("click",async()=>{await Y("Clear fruits inventory?")&&(y.fruits={},B(),U())}),function(){try{if(!localStorage.getItem(A)){const e=["mini_gacha_state_v1"];for(const t of e){const e=localStorage.getItem(t);if(e){try{localStorage.setItem(A,e)}catch(e){console.warn(e)}const n=localStorage.getItem(t+"_hash");if(n)try{localStorage.setItem(N,n)}catch(e){console.warn(e)}break}}}const e=localStorage.getItem(A),t=localStorage.getItem(N);if(e){const n=JSON.parse(e),i=Object.prototype.hasOwnProperty.call(n,"petRerollsUsed"),o=Object.prototype.hasOwnProperty.call(n,"redeemedGiftCodes"),a=Object.prototype.hasOwnProperty.call(n,"tears"),s=Object.prototype.hasOwnProperty.call(n,"potionInventory");y={coins:n.coins??2e3,enchantPoints:n.enchantPoints??0,inventory:n.inventory??{},fruits:n.fruits??{},petEnchantments:n.petEnchantments??{},petNames:n.petNames??{},petRerollsUsed:n.petRerollsUsed??{},potionActive:n.potionActive??!1,potionEndsAt:n.potionEndsAt??0,luckStacks:n.luckStacks??0,bennyActive:n.bennyActive??!1,bennyEndsAt:n.bennyEndsAt??0,blessingActive:n.blessingActive??!1,blessingEndsAt:n.blessingEndsAt??0,bonusInventorySlots:n.bonusInventorySlots??0,redeemedGiftCodes:n.redeemedGiftCodes??[],tears:n.tears??0,potionInventory:n.potionInventory??[]};const r=D(y);if(t&&t!==r)if(i&&o&&a&&s){console.warn("Save integrity check failed. Resetting save."),localStorage.setItem("btf_save_tampered","1"),y={coins:2e3,enchantPoints:0,inventory:{},fruits:{},petEnchantments:{},petNames:{},petRerollsUsed:{},bonusInventorySlots:0,redeemedGiftCodes:[],tears:0,potionInventory:[]};try{localStorage.setItem(A,JSON.stringify(y)),localStorage.setItem(N,D(y))}catch(e){console.warn(e)}}else{console.info("Save hash mismatch due to schema upgrade; backfilling new fields without reset.");try{localStorage.setItem(N,r)}catch(e){console.warn(e)}}else if(!t)try{localStorage.setItem(N,r)}catch(e){console.warn(e)}}else y={coins:2e3,enchantPoints:0,inventory:{},fruits:{},petEnchantments:{},petNames:{},petRerollsUsed:{},bonusInventorySlots:0,redeemedGiftCodes:[],tears:0,potionInventory:[]}}catch(e){console.warn("load failed",e)}}(),y.inventory=y.inventory||{},y.fruits=y.fruits||{},U(),B(),"1"===localStorage.getItem("btf_save_tampered")&&(localStorage.removeItem("btf_save_tampered"),setTimeout(()=>{try{V("Tampering detected! Your save was reset to defaults.")}catch(e){alert("Tampering detected! Your save was reset to defaults.")}},0)),ne(),setInterval(ne,6e4);const ie=document.getElementById("welcomeModal"),oe=document.getElementById("closeWelcome");ie&&oe&&(localStorage.getItem("btf_seen_welcome")||(ie.style.display="flex",oe.addEventListener("click",()=>{ie.style.display="none",localStorage.setItem("btf_seen_welcome","true")}),ie.querySelector(".modal-backdrop")?.addEventListener("click",()=>{ie.style.display="none",localStorage.setItem("btf_seen_welcome","true")})));const ae=document.getElementById("halloweenUpdateModal"),se=document.getElementById("closeHalloweenUpdate");if(ae&&se){const e=localStorage.getItem("btf_seen_halloween_update"),t=localStorage.getItem("btf_seen_welcome"),n=()=>{e||(ae.style.display="flex")};t?n():oe?.addEventListener("click",()=>{setTimeout(n,300)}),se.addEventListener("click",()=>{ae.style.display="none",localStorage.setItem("btf_seen_halloween_update","true")}),ae.querySelector(".modal-backdrop")?.addEventListener("click",()=>{ae.style.display="none",localStorage.setItem("btf_seen_halloween_update","true")})}const re=document.getElementById("closePetInfo"),le=document.getElementById("petInfoModal");re&&le&&(re.addEventListener("click",()=>{le.style.display="none"}),le.addEventListener("click",e=>{e.target===le&&(le.style.display="none")}));const ce=document.getElementById("closePetSelector"),de=document.getElementById("petSelectorModal");ce&&de&&(ce.addEventListener("click",()=>{de.style.display="none"}),de.addEventListener("click",e=>{e.target===de&&(de.style.display="none")}));const pe=document.getElementById("closeSellPet"),ue=document.getElementById("sellPetModal");pe&&ue&&(pe.addEventListener("click",()=>{ue.style.display="none"}),ue.addEventListener("click",e=>{e.target===ue&&(ue.style.display="none")}));let me=0;setInterval(()=>{const e=F();if(e>0){const t=G(),n=Math.floor(e*t.cpsMult*t.coinGainMult);if(n>0){y.coins+=n,B(),U();const e=document.createElement("div");e.className="coin-pop",e.textContent="+"+n,document.querySelector(".wallet").appendChild(e),y.bennyActive&&y.bennyEndsAt>Date.now()&&e.classList.add("benny"),e.addEventListener("animationend",()=>e.remove())}}let t=0,n=0;for(const[e,i]of Object.entries(y.inventory)){const o=c.find(t=>t.id===e);o&&"special"===o.rarity&&(t+=i),"pet_sp_2"===e&&(n+=i)}if(t>0){const e=G();me+=.5*t*e.epGenerationMult;const n=Math.floor(me);if(n>0){me-=n,y.enchantPoints=(y.enchantPoints||0)+n,B(),U();const e=document.createElement("div");e.className="ep-pop",e.textContent="+"+n;const t=document.querySelector(".ep-display");t&&(t.appendChild(e),e.addEventListener("animationend",()=>e.remove()))}}if(n>0){const e=.2*n;if(y.tears=(y.tears||0)+e,y.tears>1e9&&(y.tears=1e9),B(),U(),void 0!==h&&h&&h.parentElement){const t=document.createElement("div");t.className="tear-pop";const n=e%1==0?e.toString():e.toFixed(1);t.textContent="+"+n,h.parentElement.style.position="relative",h.parentElement.appendChild(t),t.addEventListener("animationend",()=>t.remove())}}},1e3),setInterval(()=>{let e=!1;y.potionActive&&y.potionEndsAt<=Date.now()&&(y.potionActive=!1,y.luckStacks=0,e=!0),y.bennyActive&&y.bennyEndsAt<=Date.now()&&(y.bennyActive=!1,e=!0),y.blessingActive&&y.blessingEndsAt<=Date.now()&&(y.blessingActive=!1,e=!0),e&&(B(),U())},1e3);const ye=document.getElementById("openTerms");if(ye&&ye.addEventListener("click",()=>{window.open("terms.html","_blank")}),"undefined"!=typeof window&&(window.STORAGE_KEY=A,window.PETS=c,window.FRUITS=m,window.ENCHANTMENTS=r,window.state=y,window.coinsEl=g,window.luckMultiplierEl=w,window.saveState=B,window.updateUI=U,window.showAlert=V,window.showConfirm=Y,window.redeemGiftCode=function(e){const t=e.trim().toUpperCase();if(16!==t.length)return{success:!1,message:"Gift code must be exactly 16 characters."};if(!p[t])return{success:!1,message:"Invalid gift code."};if(y.redeemedGiftCodes&&y.redeemedGiftCodes.includes(t))return{success:!1,message:"This gift code has already been redeemed."};const n=p[t];return n.coins&&(y.coins=(y.coins||0)+n.coins),n.enchantPoints&&(y.enchantPoints=(y.enchantPoints||0)+n.enchantPoints),n.pet&&(Array.isArray(n.pet)?n.pet:[n.pet]).forEach(e=>{y.inventory[e]=(y.inventory[e]||0)+1}),"luck_potion"===n.item&&(y.potionActive=!0,y.potionEndsAt=Date.now()+3e5,y.luckStacks=Math.min((y.luckStacks||0)+1,100)),y.redeemedGiftCodes||(y.redeemedGiftCodes=[]),y.redeemedGiftCodes.push(t),B(),{success:!0,message:n.description||"Gift code redeemed successfully!"}},window.CLAIMED_CODES_KEY="btf_claimed_codes_v1"),"undefined"!=typeof window&&window.location){const e=window.location.pathname;e.includes("shop.html")?s.e(299).then(s.t.bind(s,299,23)).catch(e=>console.warn("Failed to load shop module:",e)):e.includes("inventory.html")?Promise.all([s.e(949).then(s.t.bind(s,949,23)),s.e(155).then(s.t.bind(s,155,23))]).catch(e=>console.warn("Failed to load inventory modules:",e)):e.includes("enchant.html")?s.e(98).then(s.t.bind(s,98,23)).catch(e=>console.warn("Failed to load enchant module:",e)):e.includes("leaderboard.html")?s.e(364).then(s.t.bind(s,364,23)).catch(e=>console.warn("Failed to load leaderboard module:",e)):e.includes("trade.html")&&s.e(489).then(s.t.bind(s,489,23)).catch(e=>console.warn("Failed to load trade module:",e))}})();